{"ast":null,"code":"import { Subject, zip } from 'rxjs';\nimport { io } from 'socket.io-client';\nimport { selectId, selectUsername } from '../store/user.selector';\nimport { RC4 } from '../encryption/RC4';\nimport { XTEA } from '../encryption/XTEA';\nimport { EncryptionType } from '../models/algorithms';\nimport { TigerHash } from '../hash/TigerHash';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngrx/store\";\nexport class ChatService {\n  constructor(store) {\n    this.store = store;\n    this.rc4 = new RC4();\n    this.xtea = new XTEA();\n    this.tigerHash = new TigerHash();\n    this.userinfo$ = zip(this.store.select(selectUsername), this.store.select(selectId));\n    this.socket = io(import.meta.env.NG_APP_API_URL);\n    this.messageStream = new Subject();\n    this.username = null;\n    this.id = null;\n    this.userinfo$.subscribe(([username, id]) => {\n      this.username = username;\n      this.id = id;\n    });\n    this.socket.on('messageRec', crypto => {\n      // this.store.select(selectEncryptionType).subscribe((encryptionType) => {\n      //   if (encryptionType === EncryptionType.None)\n      //     return;\n      //   else if (encryptionType === EncryptionType.RC4) {\n      //     const message = this.decryptMessage(crypto, encryptionType);\n      //     this.messageStream.next(message);\n      //   }\n      //   else if (encryptionType === EncryptionType.XTEA) {\n      //     const message = this.decryptMessage(crypto, encryptionType);\n      //   }\n      // })\n      const message = this.decryptMessage(crypto);\n      this.messageStream.next(message);\n    });\n  }\n  connect() {\n    this.socket.connect();\n  }\n  disconnect() {\n    this.socket.disconnect();\n  }\n  sendMessage(message, encryptionType) {\n    console.log(this.username);\n    console.log(this.id);\n    message = message.trim();\n    const crypto = this.encryptMessage(message, encryptionType);\n    const messageObject = {\n      algorithm: encryptionType,\n      text: message,\n      crypto: crypto,\n      owner: true,\n      senderName: this.username,\n      senderId: this.id,\n      file: false\n    };\n    this.messageStream.next({\n      ...messageObject\n    });\n    messageObject.text = null;\n    this.socket.emit('message', messageObject);\n  }\n  sendFile(file, encryptionType) {\n    const reader = new FileReader();\n    reader.readAsText(file);\n    reader.onload = () => {\n      let crypto = this.encryptMessage(reader.result, encryptionType);\n      crypto += this.tigerHash.hash(Uint8Array.from(crypto.split(``).map(char => char.charCodeAt(0))));\n      const messageObject = {\n        algorithm: encryptionType,\n        text: null,\n        crypto: crypto,\n        owner: true,\n        senderName: this.username,\n        senderId: this.id,\n        file: true\n      };\n      this.messageStream.next({\n        ...messageObject\n      });\n      messageObject.text = null;\n      this.socket.emit('message', messageObject);\n    };\n  }\n  receiveFile(message) {\n    const crypto = message.text?.slice(0, message.text.length - 24);\n    const hash = this.tigerHash.hash(Uint8Array.from(crypto.split(``).map(char => char.charCodeAt(0))));\n  }\n  encryptMessage(message, encryptionType) {\n    if (encryptionType === EncryptionType.None) return message;else if (encryptionType === EncryptionType.RC4) return this.rc4.Encrypt(message);else if (encryptionType === EncryptionType.XTEA) return this.xtea.Encrypt(message);else return message;\n  }\n  decryptMessage(cryptoMsg) {\n    let text = \"\";\n    if (cryptoMsg.algorithm === EncryptionType.None) return cryptoMsg;else if (cryptoMsg.algorithm === EncryptionType.RC4) text = this.rc4.Decrypt(cryptoMsg.crypto);else if (cryptoMsg.algorithm === EncryptionType.XTEA) text = this.xtea.Decrypt(cryptoMsg.crypto);\n    const msg = {\n      algorithm: cryptoMsg.algorithm,\n      text: text,\n      crypto: cryptoMsg.crypto,\n      owner: cryptoMsg.senderId === this.id,\n      senderName: cryptoMsg.senderName,\n      senderId: cryptoMsg.senderId,\n      file: false\n    };\n    return msg;\n  }\n  static #_ = this.ɵfac = function ChatService_Factory(t) {\n    return new (t || ChatService)(i0.ɵɵinject(i1.Store));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ChatService,\n    factory: ChatService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["Subject","zip","io","selectId","selectUsername","RC4","XTEA","EncryptionType","TigerHash","ChatService","constructor","store","rc4","xtea","tigerHash","userinfo$","select","socket","import","meta","env","NG_APP_API_URL","messageStream","username","id","subscribe","on","crypto","message","decryptMessage","next","connect","disconnect","sendMessage","encryptionType","console","log","trim","encryptMessage","messageObject","algorithm","text","owner","senderName","senderId","file","emit","sendFile","reader","FileReader","readAsText","onload","result","hash","Uint8Array","from","split","map","char","charCodeAt","receiveFile","slice","length","None","Encrypt","cryptoMsg","Decrypt","msg","_","i0","ɵɵinject","i1","Store","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\MihajloBencun\\Desktop\\Faks\\Zastita informacija\\Prvi projekat\\zastita-informacija-benc\\Prvi projekat\\chat\\src\\app\\chat\\chat.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Subject, zip } from 'rxjs';\nimport {io} from 'socket.io-client';\nimport { Message } from '../models/message.dto';\nimport { Store } from '@ngrx/store';\nimport { User } from '../models/user.model';\nimport { UserState } from '../store/user.state';\nimport { selectEncryptionType, selectId, selectUsername } from '../store/user.selector';\nimport { RC4 } from '../encryption/RC4';\nimport { XTEA } from '../encryption/XTEA';\nimport { EncryptionType } from '../models/algorithms';\nimport { TigerHash } from '../hash/TigerHash';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ChatService {\n  rc4 = new RC4();\n  xtea = new XTEA();\n  tigerHash = new TigerHash();\n  userinfo$ = zip(this.store.select(selectUsername), this.store.select(selectId));\n  socket = io(import.meta.env.NG_APP_API_URL);\n  messageStream: Subject<Message> = new Subject<Message>();\n  constructor(private store: Store<UserState>) { \n    this.userinfo$.subscribe(([username, id]) => {\n      this.username = username;\n      this.id = id;\n    });\n    this.socket.on('messageRec', (crypto) => {\n      // this.store.select(selectEncryptionType).subscribe((encryptionType) => {\n      //   if (encryptionType === EncryptionType.None)\n      //     return;\n      //   else if (encryptionType === EncryptionType.RC4) {\n      //     const message = this.decryptMessage(crypto, encryptionType);\n      //     this.messageStream.next(message);\n      //   }\n      //   else if (encryptionType === EncryptionType.XTEA) {\n      //     const message = this.decryptMessage(crypto, encryptionType);\n      //   }\n      // })\n      const message = this.decryptMessage(crypto);\n      this.messageStream.next(message);\n    });\n  }\n  username: string | null = null;\n  id: string | null = null;\n\n\n  connect(){\n    this.socket.connect();\n  }\n  disconnect(){\n    this.socket.disconnect();\n  }\n  sendMessage(message: string, encryptionType: EncryptionType){\n    console.log(this.username);\n    console.log(this.id);\n    message = message.trim();\n    const crypto = this.encryptMessage(message, encryptionType)\n    const messageObject : Message = {algorithm: encryptionType, text:message, crypto:crypto, owner: true, senderName: this.username!, senderId: this.id!, file: false} \n    this.messageStream.next({...messageObject});\n    messageObject.text = null;\n    this.socket.emit('message', messageObject);\n  }\n  sendFile(file: File, encryptionType: EncryptionType){\n    const reader = new FileReader();\n    reader.readAsText(file);\n    reader.onload = () => {\n      let crypto = this.encryptMessage(reader.result as string, encryptionType);\n      crypto += this.tigerHash.hash(Uint8Array.from(crypto.split(``).map((char) => char.charCodeAt(0))));\n      const messageObject : Message = {algorithm: encryptionType, text:null, crypto:crypto, owner: true, senderName: this.username!, senderId: this.id!, file: true} \n      this.messageStream.next({...messageObject});\n      messageObject.text = null;\n      this.socket.emit('message', messageObject);\n    }\n  }\n\n  receiveFile(message: Message){\n    const crypto = message.text?.slice(0, message.text.length - 24);\n    const hash = this.tigerHash.hash(Uint8Array.from(crypto!.split(``).map((char) => char.charCodeAt(0))));\n  }\n  encryptMessage(message: string, encryptionType: EncryptionType): string{\n    if (encryptionType === EncryptionType.None)\n      return message;\n    else if (encryptionType === EncryptionType.RC4)\n      return this.rc4.Encrypt(message);\n    else if (encryptionType === EncryptionType.XTEA)\n      return this.xtea.Encrypt(message);\n    else\n      return message;\n  }\n  decryptMessage(cryptoMsg: Message): Message {\n    let text = \"\";\n    if (cryptoMsg.algorithm === EncryptionType.None)\n      return cryptoMsg;\n    else if (cryptoMsg.algorithm === EncryptionType.RC4)\n      text = this.rc4.Decrypt(cryptoMsg.crypto);\n    else if (cryptoMsg.algorithm === EncryptionType.XTEA)\n      text = this.xtea.Decrypt(cryptoMsg.crypto);\n    const msg: Message = {algorithm: cryptoMsg.algorithm, text:text, crypto:cryptoMsg.crypto, owner: cryptoMsg.senderId === this.id, senderName: cryptoMsg.senderName, senderId: cryptoMsg.senderId, file: false};\n    return msg;\n  }\n}\n"],"mappings":"AACA,SAASA,OAAO,EAAEC,GAAG,QAAQ,MAAM;AACnC,SAAQC,EAAE,QAAO,kBAAkB;AAKnC,SAA+BC,QAAQ,EAAEC,cAAc,QAAQ,wBAAwB;AACvF,SAASC,GAAG,QAAQ,mBAAmB;AACvC,SAASC,IAAI,QAAQ,oBAAoB;AACzC,SAASC,cAAc,QAAQ,sBAAsB;AACrD,SAASC,SAAS,QAAQ,mBAAmB;;;AAK7C,OAAM,MAAOC,WAAW;EAOtBC,YAAoBC,KAAuB;IAAvB,KAAAA,KAAK,GAALA,KAAK;IANzB,KAAAC,GAAG,GAAG,IAAIP,GAAG,EAAE;IACf,KAAAQ,IAAI,GAAG,IAAIP,IAAI,EAAE;IACjB,KAAAQ,SAAS,GAAG,IAAIN,SAAS,EAAE;IAC3B,KAAAO,SAAS,GAAGd,GAAG,CAAC,IAAI,CAACU,KAAK,CAACK,MAAM,CAACZ,cAAc,CAAC,EAAE,IAAI,CAACO,KAAK,CAACK,MAAM,CAACb,QAAQ,CAAC,CAAC;IAC/E,KAAAc,MAAM,GAAGf,EAAE,CAACgB,MAAM,CAACC,IAAI,CAACC,GAAG,CAACC,cAAc,CAAC;IAC3C,KAAAC,aAAa,GAAqB,IAAItB,OAAO,EAAW;IAsBxD,KAAAuB,QAAQ,GAAkB,IAAI;IAC9B,KAAAC,EAAE,GAAkB,IAAI;IArBtB,IAAI,CAACT,SAAS,CAACU,SAAS,CAAC,CAAC,CAACF,QAAQ,EAAEC,EAAE,CAAC,KAAI;MAC1C,IAAI,CAACD,QAAQ,GAAGA,QAAQ;MACxB,IAAI,CAACC,EAAE,GAAGA,EAAE;IACd,CAAC,CAAC;IACF,IAAI,CAACP,MAAM,CAACS,EAAE,CAAC,YAAY,EAAGC,MAAM,IAAI;MACtC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,MAAMC,OAAO,GAAG,IAAI,CAACC,cAAc,CAACF,MAAM,CAAC;MAC3C,IAAI,CAACL,aAAa,CAACQ,IAAI,CAACF,OAAO,CAAC;IAClC,CAAC,CAAC;EACJ;EAKAG,OAAOA,CAAA;IACL,IAAI,CAACd,MAAM,CAACc,OAAO,EAAE;EACvB;EACAC,UAAUA,CAAA;IACR,IAAI,CAACf,MAAM,CAACe,UAAU,EAAE;EAC1B;EACAC,WAAWA,CAACL,OAAe,EAAEM,cAA8B;IACzDC,OAAO,CAACC,GAAG,CAAC,IAAI,CAACb,QAAQ,CAAC;IAC1BY,OAAO,CAACC,GAAG,CAAC,IAAI,CAACZ,EAAE,CAAC;IACpBI,OAAO,GAAGA,OAAO,CAACS,IAAI,EAAE;IACxB,MAAMV,MAAM,GAAG,IAAI,CAACW,cAAc,CAACV,OAAO,EAAEM,cAAc,CAAC;IAC3D,MAAMK,aAAa,GAAa;MAACC,SAAS,EAAEN,cAAc;MAAEO,IAAI,EAACb,OAAO;MAAED,MAAM,EAACA,MAAM;MAAEe,KAAK,EAAE,IAAI;MAAEC,UAAU,EAAE,IAAI,CAACpB,QAAS;MAAEqB,QAAQ,EAAE,IAAI,CAACpB,EAAG;MAAEqB,IAAI,EAAE;IAAK,CAAC;IAClK,IAAI,CAACvB,aAAa,CAACQ,IAAI,CAAC;MAAC,GAAGS;IAAa,CAAC,CAAC;IAC3CA,aAAa,CAACE,IAAI,GAAG,IAAI;IACzB,IAAI,CAACxB,MAAM,CAAC6B,IAAI,CAAC,SAAS,EAAEP,aAAa,CAAC;EAC5C;EACAQ,QAAQA,CAACF,IAAU,EAAEX,cAA8B;IACjD,MAAMc,MAAM,GAAG,IAAIC,UAAU,EAAE;IAC/BD,MAAM,CAACE,UAAU,CAACL,IAAI,CAAC;IACvBG,MAAM,CAACG,MAAM,GAAG,MAAK;MACnB,IAAIxB,MAAM,GAAG,IAAI,CAACW,cAAc,CAACU,MAAM,CAACI,MAAgB,EAAElB,cAAc,CAAC;MACzEP,MAAM,IAAI,IAAI,CAACb,SAAS,CAACuC,IAAI,CAACC,UAAU,CAACC,IAAI,CAAC5B,MAAM,CAAC6B,KAAK,CAAC,EAAE,CAAC,CAACC,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAClG,MAAMpB,aAAa,GAAa;QAACC,SAAS,EAAEN,cAAc;QAAEO,IAAI,EAAC,IAAI;QAAEd,MAAM,EAACA,MAAM;QAAEe,KAAK,EAAE,IAAI;QAAEC,UAAU,EAAE,IAAI,CAACpB,QAAS;QAAEqB,QAAQ,EAAE,IAAI,CAACpB,EAAG;QAAEqB,IAAI,EAAE;MAAI,CAAC;MAC9J,IAAI,CAACvB,aAAa,CAACQ,IAAI,CAAC;QAAC,GAAGS;MAAa,CAAC,CAAC;MAC3CA,aAAa,CAACE,IAAI,GAAG,IAAI;MACzB,IAAI,CAACxB,MAAM,CAAC6B,IAAI,CAAC,SAAS,EAAEP,aAAa,CAAC;IAC5C,CAAC;EACH;EAEAqB,WAAWA,CAAChC,OAAgB;IAC1B,MAAMD,MAAM,GAAGC,OAAO,CAACa,IAAI,EAAEoB,KAAK,CAAC,CAAC,EAAEjC,OAAO,CAACa,IAAI,CAACqB,MAAM,GAAG,EAAE,CAAC;IAC/D,MAAMT,IAAI,GAAG,IAAI,CAACvC,SAAS,CAACuC,IAAI,CAACC,UAAU,CAACC,IAAI,CAAC5B,MAAO,CAAC6B,KAAK,CAAC,EAAE,CAAC,CAACC,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACxG;EACArB,cAAcA,CAACV,OAAe,EAAEM,cAA8B;IAC5D,IAAIA,cAAc,KAAK3B,cAAc,CAACwD,IAAI,EACxC,OAAOnC,OAAO,CAAC,KACZ,IAAIM,cAAc,KAAK3B,cAAc,CAACF,GAAG,EAC5C,OAAO,IAAI,CAACO,GAAG,CAACoD,OAAO,CAACpC,OAAO,CAAC,CAAC,KAC9B,IAAIM,cAAc,KAAK3B,cAAc,CAACD,IAAI,EAC7C,OAAO,IAAI,CAACO,IAAI,CAACmD,OAAO,CAACpC,OAAO,CAAC,CAAC,KAElC,OAAOA,OAAO;EAClB;EACAC,cAAcA,CAACoC,SAAkB;IAC/B,IAAIxB,IAAI,GAAG,EAAE;IACb,IAAIwB,SAAS,CAACzB,SAAS,KAAKjC,cAAc,CAACwD,IAAI,EAC7C,OAAOE,SAAS,CAAC,KACd,IAAIA,SAAS,CAACzB,SAAS,KAAKjC,cAAc,CAACF,GAAG,EACjDoC,IAAI,GAAG,IAAI,CAAC7B,GAAG,CAACsD,OAAO,CAACD,SAAS,CAACtC,MAAM,CAAC,CAAC,KACvC,IAAIsC,SAAS,CAACzB,SAAS,KAAKjC,cAAc,CAACD,IAAI,EAClDmC,IAAI,GAAG,IAAI,CAAC5B,IAAI,CAACqD,OAAO,CAACD,SAAS,CAACtC,MAAM,CAAC;IAC5C,MAAMwC,GAAG,GAAY;MAAC3B,SAAS,EAAEyB,SAAS,CAACzB,SAAS;MAAEC,IAAI,EAACA,IAAI;MAAEd,MAAM,EAACsC,SAAS,CAACtC,MAAM;MAAEe,KAAK,EAAEuB,SAAS,CAACrB,QAAQ,KAAK,IAAI,CAACpB,EAAE;MAAEmB,UAAU,EAAEsB,SAAS,CAACtB,UAAU;MAAEC,QAAQ,EAAEqB,SAAS,CAACrB,QAAQ;MAAEC,IAAI,EAAE;IAAK,CAAC;IAC7M,OAAOsB,GAAG;EACZ;EAAC,QAAAC,CAAA,G;qBArFU3D,WAAW,EAAA4D,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,KAAA;EAAA;EAAA,QAAAC,EAAA,G;WAAXhE,WAAW;IAAAiE,OAAA,EAAXjE,WAAW,CAAAkE,IAAA;IAAAC,UAAA,EAFV;EAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}