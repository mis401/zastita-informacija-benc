{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, ElementRef, ViewChild } from '@angular/core';\nimport { EncryptionType } from '../models/algorithms';\nimport { ChangeEncryptionType } from '../store/user.actions';\nexport let ChatComponent = class ChatComponent {\n  constructor(service, store) {\n    this.service = service;\n    this.store = store;\n    this.myScrollContainer = new ElementRef('scrollable');\n    this.messageTextElement = new ElementRef('messageText');\n    this.messages = [];\n    this.file = null;\n    this.toggleEncryption = false;\n    this.encryptionType = EncryptionType.RC4;\n    this.messages$ = this.service.messageStream.subscribe(message => {\n      console.log(message);\n      if (message.file) {\n        const file = new File([message.fileContent], '', {\n          type: message.text\n        });\n        message.fileContent = file;\n      }\n      this.messages.push(message);\n    });\n    this.messageText = '';\n    window.onbeforeunload = () => this.ngOnDestroy();\n  }\n  ngOnInit() {\n    this.service.connect();\n  }\n  ngOnDestroy() {\n    console.log(`Destroy pozvan`);\n    this.service.disconnect();\n  }\n  ngAfterViewChecked() {\n    this.scrollToBottom();\n  }\n  onFileSelected(event) {\n    this.file = event.target.files[0];\n  }\n  switchEncryption() {\n    if (this.encryptionType === EncryptionType.RC4) {\n      this.encryptionType = EncryptionType.XTEA;\n      this.store.dispatch(ChangeEncryptionType({\n        encryptionType: EncryptionType.XTEA\n      }));\n    } else {\n      this.encryptionType = EncryptionType.RC4;\n      this.store.dispatch(ChangeEncryptionType({\n        encryptionType: EncryptionType.RC4\n      }));\n    }\n  }\n  scrollToBottom() {\n    try {\n      this.myScrollContainer.nativeElement.scrollTop = this.myScrollContainer.nativeElement.scrollHeight;\n    } catch (err) {}\n  }\n  sendMessage() {\n    if (!this.file && !this.messageText) return;\n    if (this.file) {\n      this.service.sendFile(this.file, this.encryptionType);\n      this.file = null;\n      return;\n    }\n    this.service.sendMessage(this.messageText, this.encryptionType);\n    this.messageText = '';\n  }\n};\n__decorate([ViewChild('scrollable')], ChatComponent.prototype, \"myScrollContainer\", void 0);\n__decorate([ViewChild('messageText')], ChatComponent.prototype, \"messageTextElement\", void 0);\nChatComponent = __decorate([Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.scss']\n})], ChatComponent);","map":{"version":3,"names":["Component","ElementRef","ViewChild","EncryptionType","ChangeEncryptionType","ChatComponent","constructor","service","store","myScrollContainer","messageTextElement","messages","file","toggleEncryption","encryptionType","RC4","messages$","messageStream","subscribe","message","console","log","File","fileContent","type","text","push","messageText","window","onbeforeunload","ngOnDestroy","ngOnInit","connect","disconnect","ngAfterViewChecked","scrollToBottom","onFileSelected","event","target","files","switchEncryption","XTEA","dispatch","nativeElement","scrollTop","scrollHeight","err","sendMessage","sendFile","__decorate","selector","templateUrl","styleUrls"],"sources":["C:\\Users\\MihajloBencun\\Desktop\\Faks\\Zastita informacija\\Prvi projekat\\zastita-informacija-benc\\Prvi projekat\\chat\\src\\app\\chat\\chat.component.ts"],"sourcesContent":["import { AfterViewChecked, Component, ElementRef, OnDestroy, OnInit, ViewChild } from '@angular/core';\nimport { ChatService } from './chat.service';\nimport { Message } from '../models/message.dto';\nimport { EncryptionType } from '../models/algorithms';\nimport { Store } from '@ngrx/store';\nimport { User } from '../models/user.model';\nimport { UserState } from '../store/user.state';\nimport { ChangeEncryptionType } from '../store/user.actions';\nimport { TigerHash } from '../hash/TigerHash';\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.component.html',\n  styleUrls: ['./chat.component.scss']\n})\nexport class ChatComponent implements OnInit, OnDestroy, AfterViewChecked{\n  constructor(private service: ChatService, private store: Store<UserState>) {\n    window.onbeforeunload = () => this.ngOnDestroy();\n    \n  }\n  @ViewChild('scrollable') private myScrollContainer: ElementRef = new ElementRef('scrollable');\n  @ViewChild('messageText') private messageTextElement: ElementRef = new ElementRef('messageText');\n\n  messages: Message[] = [];\n  file: File | null = null;\n  toggleEncryption: boolean = false;\n  encryptionType: EncryptionType = EncryptionType.RC4;\n  messages$ = this.service.messageStream.subscribe((message) => {\n    console.log(message);\n    if (message.file){\n      const file = new File([message.fileContent!], '', {type: message.text!});\n      message.fileContent = file;\n    }\n    this.messages.push(message);\n  });\n  messageText : string = '';\n  ngOnInit(){\n    this.service.connect();\n    \n  }\n  \n  ngOnDestroy(): void {\n    console.log(`Destroy pozvan`);\n    this.service.disconnect();\n  }\n  ngAfterViewChecked(): void {\n    this.scrollToBottom();\n  }\n\n  onFileSelected(event: any) {\n    this.file = event.target.files[0];\n    \n  }\n\n  switchEncryption(){\n    if (this.encryptionType === EncryptionType.RC4) {\n      this.encryptionType = EncryptionType.XTEA;\n      this.store.dispatch(ChangeEncryptionType({encryptionType: EncryptionType.XTEA}));\n    }\n    else {\n      this.encryptionType = EncryptionType.RC4;\n      this.store.dispatch(ChangeEncryptionType({encryptionType: EncryptionType.RC4}));\n    }\n  }\n  scrollToBottom():void {\n    try {\n        this.myScrollContainer.nativeElement.scrollTop = this.myScrollContainer.nativeElement.scrollHeight;\n    } catch(err) { }                 \n  }\n\n  sendMessage(){\n    if(!this.file && !this.messageText)\n      return;\n    if (this.file){\n      this.service.sendFile(this.file, this.encryptionType);\n      this.file = null;\n      return;\n    }\n    this.service.sendMessage(this.messageText, this.encryptionType);\n    this.messageText = '';\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}